<?xml version="1.0" encoding="utf-8" ?>
<odoo>
<template id="internal_report_sale">
        <t t-if="not o" t-set="o" t-value="doc"/>
        <t t-if="not company">
            <!-- Multicompany -->
            <t t-if="company_id">
                <t t-set="company" t-value="company_id"/>
            </t>
            <t t-elif="o and 'company_id' in o">
                <t t-set="company" t-value="o.company_id.sudo()"/>
            </t>
            <t t-else="else">
                <t t-set="company" t-value="res_company"/>
            </t>
        </t>

        <t t-esc="company.update_scss()"/>
        <div class="header">
            <div class="row">
                <div class="col-2">
                </div>
                <div class="col-4 offset-2 text-center">
                    <h5><strong>Drogueria La Fe Mas</strong></h5>
                    <h7><strong>Nit:900.803.927-8</strong></h7>
                    <h8><strong>Direccion: Cra 17 Nro 13B Bis 05</strong></h8>
                </div>
                <div class="col-1 offset-3 text-right">
                </div>
            </div>
        </div>
        <div class="article" t-att-data-oe-model="o and o._name" t-att-data-oe-id="o and o.id" t-att-data-oe-lang="o and o.env.context.get('lang')">
          <t t-raw="0"/>
        </div>
</template>

<template id="report_session_details">
    <t t-call="web.html_container">
        <t t-foreach="docs" t-as="o">
            <t t-call="l10n_co_pos_details.internal_report_sale">
                <div class="page">
                    <h4>Informe de cierre:</h4>
                    <h2>Sesi√≥n: <span t-field="o.name" /></h2>
                    <h5>Impreso del PC Dell optiplex 5490 serie G6DR1N3</h5>

                    <div class="row mt32 mb32">
                        <div class="col-auto mw-100 mb-3">
                            <strong>Impreso Por</strong>:<br />
                            <t t-set="usuario_imprime" t-value="o.user_print()" />
                            <span t-esc="usuario_imprime" />
                        </div>
                        <div class="col-auto mw-100 mb-3">
                            <strong>Fecha Informe</strong>:<br />
                            <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/>
                        </div>
                        <div class="col-auto mw-100 mb-3">
                            <strong>Fecha Inicio</strong>:<br />
                            <span t-field="o.start_at" />
                        </div>
                        <div class="col-auto mw-100 mb-3">
                            <strong>Fecha Cierre</strong>:<br />
                            <span t-field="o.stop_at" />
                        </div>
                    </div>



                    <h4>Orden Pos: <span t-esc="o.order_ids[-1]['name']"/> Hasta: <span t-esc="o.order_ids[0]['name']"/> </h4>
                    <table class="table table-sm o_main_table">
                            <thead>
                                <tr>
                                    <th>Orden</th>
                                    <th>Item</th>
                                    <th>Sub.Total</th>
                                    <th>Iva 19%</th>
                                    <th>Iva 5%</th>
                                    <th>Excluidas</th>
                                    <th>T.Factura</th>
                                </tr>
                            </thead>
                    <t t-set="totalitem" t-value="0"/>
                    <t t-set="totalimportebase" t-value="0"/>
                    <t t-set="totalimpuestos19" t-value="0"/>
                    <t t-set="totalimpuestos5" t-value="0"/>
                    <t t-set="totalexentos" t-value="0"/>
                    <t t-set="totalfacturas" t-value="0"/>
                    <t t-foreach="o.order_ids" t-as="order">
                            <tbody>
                                <t t-set="item" t-value="0"/>
                                <t t-set="subtotal" t-value="0"/>
                                <t t-set="impbase" t-value="0"/>
                                <t t-set="iva19" t-value="0"/>
                                <t t-set="iva5" t-value="0"/>
                                <t t-set="exentos" t-value="0"/>
                                <t t-set="totalfactura" t-value="0"/>
                                <t t-foreach="order.lines" t-as="line">
                                    <t t-set="item" t-value="(line.qty + item)" />
                                    <t t-set="datos" t-value="line._compute_tax_report()" />
                                    <t t-set="iva19" t-value="(iva19 + datos['iva19'])" />
                                    <t t-set="iva5" t-value="(iva5 + datos['iva5'])" />
                                    <t t-set="exentos" t-value="(exentos + datos['exento'])" />
                                    <t t-set="subtotal" t-value="(line.price_subtotal + subtotal)" />
                                    <t t-set="totalfactura" t-value="(order.amount_total)" />
                                </t>
                                <t t-set="totalitem" t-value="(totalitem + item)" />
                                <t t-set="totalimportebase" t-value="(totalimportebase + subtotal)" />
                                <t t-set="totalfacturas" t-value="(totalfacturas + totalfactura)" />
                                <t t-set="totalimpuestos19" t-value="(totalimpuestos19 + iva19)" />
                                <t t-set="totalimpuestos5" t-value="(totalimpuestos5 +  iva5)" />
                                <t t-set="totalexentos" t-value="(totalexentos + exentos)" />
                                <tr>
                                    <td><span t-field="order.name" /></td>
                                    <td><span t-esc="item" /></td>
                                    <td><span t-esc="subtotal" t-options='{"widget": "float", "precision": 2}'/></td>
                                    <td><span t-esc="iva19" t-options='{"widget": "float", "precision": 2}'/></td>
                                    <td><span t-esc="iva5" t-options='{"widget": "float", "precision": 2}'/></td>
                                    <td><span t-esc="exentos" t-options='{"widget": "float", "precision": 2}'/></td>
                                    <td><span t-esc="totalfactura" t-options='{"widget": "float", "precision": 2}'/></td>
                                </tr>
                            </tbody>
                        </t>
                    </table>
                     <table class="table table-sm o_main_table">
                            <thead>
                                <tr>
                                    <th>Total Orden</th>
                                    <th>Total Item</th>
                                    <th>Importe Base</th>
                                    <th>Impuesto 19%</th>
                                    <th>Impuesto 5%</th>
                                    <th>Excluido</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                 <tr>
                                    <td><span t-esc="len(o.order_ids)"/></td>
                                    <td><span t-esc="totalitem" /></td>
                                    <td><span t-esc="totalimportebase" t-options='{"widget": "float", "precision": 2}'/></td>
                                    <td><span t-esc="totalimpuestos19" t-options='{"widget": "float", "precision": 2}'/></td>
                                    <td><span t-esc="totalimpuestos5" t-options='{"widget": "float", "precision": 2}'/></td>
                                    <td><span t-esc="totalexentos" t-options='{"widget": "float", "precision": 2}'/></td>
                                    <td><span t-esc="totalfacturas" t-options='{"widget": "float", "precision": 2}'/></td>
                                </tr>
                            </tbody>
                     </table>

                    <h4>Medios de pago</h4>

                    <t t-set="efectivo" t-value="o.efectivo()" />
                    <t t-set="datafono" t-value="o.datafono()" />
                    <t t-set="bancolombia" t-value="o.bancolombia()" />
                    <t t-set="credito" t-value="o.credito()" />
                     <table class="table table-sm o_main_table">
                            <tbody>
                                 <tr>
                                    <td>Efectivo</td>
                                    <td><span t-esc="efectivo" t-options='{"widget": "float", "precision": 2}'/></td>
                                </tr>
                                 <tr>
                                    <td>Transferencias</td>
                                    <td><span t-esc="bancolombia" t-options='{"widget": "float", "precision": 2}'/></td>
                                </tr>
                                 <tr>
                                    <td>Datafono</td>
                                    <td><span t-esc="datafono" t-options='{"widget": "float", "precision": 2}'/></td>
                                </tr>
                                <tr>
                                    <td>Credito</td>
                                    <td><span t-esc="credito" t-options='{"widget": "float", "precision": 2}'/></td>
                                </tr>
                            </tbody>
                     </table>


                </div>
            </t>
        </t>
    </t>
</template>
     <report
        id="action_report_l10n_co_pos_session_summary"
        string="Detalle Sesion"
        model="pos.session"
        report_type="qweb-pdf"
        name="l10n_co_pos_details.report_session_details"
        file="l10n_co_pos_details.report_session_details"
        />
</odoo>
